<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>商談スケジュール</title>

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        /* カレンダー全体を少しモダンに */
        #calendar {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 10px;
        }

        /* イベントの文字を見やすく */
        .fc-event {
            color: #fff;
            font-weight: 600;
            border-radius: 6px;
            padding: 2px 4px;
            font-size: 0.85rem;
        }

        /* ツールチップ風のスタイル */
        .fc-event:hover {
            opacity: 0.9;
            cursor: default;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h3 class="mb-3 text-center">商談スケジュール</h3>
    <div id="calendar"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    // 同じ時間に複数イベントがある場合の色配列
    const overlappingColors = ["#2196F3", "#FFC107", "#F44336"]; // 青、黄、赤

    // イベントをコピーして色を上書き
    const rawEvents = {{ events | tojson }};
    const eventCountByTime = {};

    rawEvents.forEach(e => {
        const timeKey = e.start;  // 同じ時間でグループ化
        eventCountByTime[timeKey] = (eventCountByTime[timeKey] || 0) + 1;
        const index = (eventCountByTime[timeKey] - 1) % overlappingColors.length;
        e.backgroundColor = overlappingColors[index];
        e.borderColor = overlappingColors[index];
        e.textColor = "#fff";
    });

    const calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'ja',
        initialView: 'dayGridMonth',
        height: 'auto',

        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },

        events: rawEvents,
        eventDisplay: 'block',  // ブロック表示で視認性UP
        eventContent: function(arg) {
            // タイトルと時間を表示
            return {
                html: `<div>${arg.event.title}<br><small>${arg.event.start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small></div>`
            };
        },

        // eventClick削除（受注登録不要）
    });

    calendar.render();
});
</script>

</body>
</html>
