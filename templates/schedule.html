<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>商談スケジュール</title>

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body { font-family: 'Roboto', sans-serif; }
        .fc-header-toolbar { margin-bottom: 10px; }
        .fc-toolbar-title { font-weight: 500; font-size: 1.3rem; }
        .fc-col-header-cell { background-color: #f1f3f4; color: #202124; font-weight: 500; }
        .fc-daygrid-day { position: relative; background-color: #fff; }
        .fc-daygrid-day:hover { background-color: #e8f0fe; cursor: pointer; }

        /* バッジ風ステータスリスト（月ビュー） */
        .status-list {
            font-size: 0.75rem;
            margin: 2px 0 0 0;
            padding: 0;
            list-style: none;
        }
        .status-list li {
            color: white;
            padding: 2px 4px;
            margin-bottom: 1px;
            border-radius: 4px;
            display: inline-block;
        }

        /* イベントカード */
        .fc-event, .fc-timegrid-event {
            border: none;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            padding: 4px 6px;
            font-size: 0.85rem;
            color: white;
        }

        /* 日ビューのリソースヘッダー */
        .fc-col-header-cell-cushion { font-size: 0.85rem; }

        /* Now line */
        .fc-now-indicator { background-color: #d93025 !important; }
    </style>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h3 class="mb-3 text-center">商談スケジュール</h3>
    <div id="calendar"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    // ステータス色
    const statusColors = {
        "成約": "#34A853",
        "NG": "#9E9E9E",
        "留守": "#FBBC05",
        "リスケ": "#F57C00",
        "返答待ち": "#4285F4",
        "商談待ち": "#1A73E8"
    };

    // サンプルイベント（実際は {{ events | tojson }} で渡す）
    const events = [
        { title: "商談A", start: "2026-01-23T09:00:00", status: "商談待ち", resourceId: "A" },
        { title: "商談B", start: "2026-01-23T10:00:00", status: "返答待ち", resourceId: "B" },
        { title: "商談C", start: "2026-01-23T11:00:00", status: "留守", resourceId: "C" },
        { title: "商談D", start: "2026-01-24T09:00:00", status: "商談待ち", resourceId: "D" }
    ];

    // 日ビュー用リソース（商談名）
    const resources = [
        { id: "A", title: "商談A" },
        { id: "B", title: "商談B" },
        { id: "C", title: "商談C" },
        { id: "D", title: "商談D" }
    ];

    const calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'ja',
        initialView: 'dayGridMonth',
        height: 'auto',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,resourceTimeGridDay'
        },
        events: events,
        resources: resources,

        // カスタムイベント表示
        eventContent: function(arg) {
            const status = arg.event.extendedProps.status || '未定';
            const color = statusColors[status] || '#BDBDBD';

            if (arg.view.type === 'dayGridMonth') {
                // 月ビュー：同日イベントをステータス別に集計
                const dayEvents = calendar.getEvents().filter(ev => ev.startStr.split('T')[0] === arg.event.startStr.split('T')[0]);
                const counts = {};
                dayEvents.forEach(ev => { 
                    const s = ev.extendedProps.status || '未定';
                    counts[s] = (counts[s] || 0) + 1;
                });

                let html = '<ul class="status-list">';
                for (let s in counts) {
                    html += `<li style="background-color:${statusColors[s]||'#BDBDBD'}">${s}: ${counts[s]}件</li>`;
                }
                html += '</ul>';
                return { html: html };
            } else if (arg.view.type === 'timeGridWeek') {
                return { html: `<div style="background-color:${color}; padding:2px 4px; border-radius:6px;">${arg.event.title} (${status})</div>` };
            } else if (arg.view.type === 'resourceTimeGridDay') {
                return { html: `<div style="background-color:${color}; padding:2px 4px; border-radius:6px;">${status}</div>` };
            }
        },

        // 日クリックで日ビューに
        dateClick: function(info) {
            calendar.changeView('resourceTimeGridDay', info.dateStr);
        },

        nowIndicator: true,
        dayMaxEventRows: true,
        slotMinTime: "08:00:00",
        slotMaxTime: "20:00:00"
    });

    calendar.render();
});
</script>

</body>
</html>
