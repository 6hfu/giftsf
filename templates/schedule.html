<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>商談カレンダー（週）</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <style>
        body {
            background: #f5f7fa;
            font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
            margin: 0;
        }

        /* 土日背景 */
        .fc-day-sun { background: rgba(244, 67, 54, 0.06); }
        .fc-day-sat { background: rgba(33, 150, 243, 0.06); }

        /* 1画面に収めるため時間枠を圧縮 */
        .fc-timegrid-slot { height: 34px !important; }

        /* 件数イベントだけ高さを2時間分にする */
        .summary-event {
            font-size: 20px;
            font-weight: 700;
            text-align: left;
            line-height: 1.2;
            border-radius: 8px;
        
            /* 高さを指定（例: 2時間分 = 34px × 2 × 60分 ÷ 1分の高さ?） */
            height: calc(68px * 2 * 60 / 60); /* 2時間分 */
            min-height: calc(68px * 2); /* 安全策としてmin-heightも */
        }


        /* リロード促しバー */
        #reloadNotice {
            position: fixed;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: #1976D2;
            color: #fff;
            padding: 12px 20px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            cursor: pointer;
            display: none;
            z-index: 9999;
        }
        #reloadNotice:hover { background: #0D47A1; }
    </style>
</head>
<body>
    <div id="calendar"></div>
    <div id="reloadNotice">⟳ しばらく更新されていません。クリックして再読み込み</div>

    <script>
    const RAW_EVENTS = {{ events | tojson | safe }};
    
    // ==========================
    // 文字色自動判定
    // ==========================
    function getTextColor(bgColor) {
        const rgb = bgColor.match(/\d+/g).map(Number);
        const brightness = (rgb[0]*299 + rgb[1]*587 + rgb[2]*114) / 1000;
        return brightness > 150 ? '#000' : '#fff';
    }
    
    // ==========================
    // 個別イベント生成
    // ==========================
    function generateMeetingEvents() {
    
        const events = [];
    
        RAW_EVENTS.forEach(ev => {
    
            if (!ev.start) return;
    
            // UTC → JST
            const dt = new Date(ev.start);
            dt.setHours(dt.getHours() + 9);
    
            const start = new Date(dt);
    
            // 2時間表示
            const end = new Date(dt);
            end.setHours(end.getHours() + 2);
            end.setMinutes(end.getMinutes() - 1);
    
            const hh = String(start.getHours()).padStart(2,'0');
            const mm = String(start.getMinutes()).padStart(2,'0');
    
            const eh = String(end.getHours()).padStart(2,'0');
            const em = String(end.getMinutes()).padStart(2,'0');
    
            const timeText = `${hh}:${mm}~${eh}:${em}`;
    
            const account = ev.title || "名称未設定";
            const owner = ev.extendedProps?.meeting_owner || "";
    
            const bg = "#64B5F6";
    
            events.push({
                title:
                    `${timeText}\n${account}\n${owner}`,
    
                start: start,
                end: end,
    
                backgroundColor: bg,
                borderColor: bg,
                textColor: getTextColor(bg),
    
                classNames: ['summary-event']
            });
    
        });
    
        return events;
    }
    </script>

</body>
</html>
