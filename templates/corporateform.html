<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>商談登録フォーム</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: #f5f7fa;
        font-family: 'Noto Sans JP', sans-serif;
        padding: 2rem 0;
    }

    .nav-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .form-container {
        background: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        padding: 2rem 2.5rem;
        max-width: 650px;
        margin: auto;
    }

    h2 {
        font-weight: 700;
        color: #343a40;
        margin-bottom: 2rem;
        text-align: center;
    }

    label {
        font-weight: 500;
        color: #495057;
    }

    .form-control {
        border-radius: 0.6rem;
        padding: 0.75rem;
        border: 1px solid #ced4da;
        transition: all 0.2s ease;
    }

    .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.2rem rgba(13,110,253,.25);
    }

    textarea.form-control {
        min-height: 220px;
        white-space: pre-wrap;
    }

    button.btn-primary {
        padding: 0.75rem 2rem;
        font-size: 1.1rem;
        border-radius: 0.75rem;
        font-weight: 600;
        width: 100%;
    }

    .text-danger-small {
        font-size: 0.8em;
        color: red;
    }

    .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220,53,69,.25) !important;
    }

    .section-divider {
        margin: 2rem 0 1.5rem;
        border-top: 1px dashed #ced4da;
    }
</style>
</head>
<body>

<!-- 上部メニューボタン -->
<div class="nav-buttons">
    <a href="https://giftsf.onrender.com/menu_page" class="btn btn-outline-primary">メニュー</a>
    <a href="https://giftsf.onrender.com/schedule" class="btn btn-outline-success">商談スケジュール</a>
</div>

<div class="form-container">
    <h2>商談登録フォーム</h2>

    <form id="appointmentForm" method="POST" action="{{ url_for('corporateform_submit') }}">

        <!-- 店舗名 -->
        <div class="mb-3">
            <label for="Name" class="form-label">
                店舗名 <span class="text-danger-small">※必須</span>
            </label>
            <input type="text" class="form-control" id="Name" name="Name" required>
        </div>

        <!-- 店舗電話番号 -->
        <div class="mb-3">
            <label for="X1__c" class="form-label">店舗電話番号</label>
            <input type="tel" class="form-control" id="X1__c" name="X1__c">
        </div>

        <!-- オーナー名 -->
        <div class="mb-3">
            <label for="Field327__c" class="form-label">オーナー名</label>
            <input type="text" class="form-control" id="Field327__c" name="Field327__c">
        </div>

        <!-- オーナー連絡先 -->
        <div class="mb-3">
            <label for="Field328__c" class="form-label">オーナー連絡先</label>
            <input type="tel" class="form-control" id="Field328__c" name="Field328__c">
        </div>

        <div class="section-divider"></div>

        <!-- APO（新規・見込） -->
        <div class="mb-3">
            <label for="Field353__c" class="form-label">APO</label>
            <select class="form-select" id="Field353__c" name="Field353__c">
                <option value="">選択してください</option>
                <option value="新規">新規</option>
                <option value="見込み">見込み</option>
            </select>
        </div>

        <!-- リスト名 -->
        <div class="mb-3">
            <label for="Field22__c" class="form-label">リスト名</label>
            <input type="text" class="form-control" id="Field22__c" name="Field22__c">
        </div>

        <!-- 営コメ -->
        <div class="mb-3">
            <label for="Field8__c" class="form-label">営コメ</label>
            <textarea
                class="form-control"
                id="Field8__c"
                name="Field8__c"
            >{{ apo_default_comment }}</textarea>
        </div>

        <div class="section-divider"></div>

        <!-- 商談希望日 -->
        <div class="mb-3">
            <label for="Field24__c" class="form-label">
                商談希望日 <span class="text-danger-small">※必須</span>
            </label>
            <input type="date" class="form-control" id="Field24__c" name="Field24__c" required>
        </div>

        <!-- 商談希望時間 -->
        <div class="mb-3">
            <label for="Field25__c" class="form-label">
                商談希望時間 <span class="text-danger-small">※必須</span>
            </label>
            <input
                type="time"
                class="form-control"
                id="Field25__c"
                name="Field25__c"
                step="60"
                min="09:00"
                max="20:59"
                required
            >
            <small class="form-text text-muted">※1分単位で入力可能</small>
        </div>

        <!-- 獲得者（ログインID） -->
        <input type="hidden" name="Field207__c" value="{{ login_id }}">

        <button type="submit" class="btn btn-primary">送信</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {

    // 今日以降のみ選択可
    const today = new Date().toISOString().split('T')[0];
    $('#Field24__c').attr('min', today);

    const requiredFields = ['Name', 'Field24__c', 'Field25__c'];

    $('#appointmentForm').on('submit', function (e) {
        let isValid = true;

        requiredFields.forEach(id => $('#' + id).removeClass('is-invalid'));

        requiredFields.forEach(id => {
            const val = $('#' + id).val();
            if (!val || val.trim() === "") {
                $('#' + id).addClass('is-invalid');
                isValid = false;
            }
        });

        if (!isValid) {
            alert('必須項目が未入力です。赤枠の項目を確認してください。');
            e.preventDefault();
            return false;
        }

        // time 補正
        const timeField = $('#Field25__c');
        let timeVal = timeField.val();
        if (timeVal && /^\d{1,2}:\d{2}$/.test(timeVal)) {
            timeField.val(timeVal.padStart(5, '0'));
        }

        // 二重送信防止
        const $btn = $(this).find('button[type="submit"]');
        $btn.prop('disabled', true).text('送信中...');

        setTimeout(() => {
            $btn.prop('disabled', false).text('送信');
        }, 10000);
    });
});
</script>

</body>
</html>
